@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
    --max-width: 1400px;
    --sidebar-width: 260px;
    --gradient-brand: linear-gradient(135deg, #1c8090 0%, #1f9eab 50%, #3abac6 100%);
    --gradient-accent: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
    --gradient-hero: linear-gradient(135deg, #1c8090 0%, #1a9baa 30%, #23b4c4 60%, #3abac6 100%);
    --gradient-surface: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
}

body {
    @apply bg-surface-50 text-surface-800 antialiased;
    font-family: 'Poppins', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* ─── Card & Surface Styles ─────────────────────────────────────── */
.glass-card {
    @apply bg-white border border-surface-200 shadow-card rounded-xl;
}

.glass-sidebar {
    background: rgba(255, 255, 255, 0.82);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-right: 1px solid rgba(226, 232, 240, 0.8);
    box-shadow: 4px 0 24px rgba(0, 0, 0, 0.03), 1px 0 0 rgba(0, 0, 0, 0.04);
}

/* ─── Session Panel Scrollbar ────────────────────────────────────── */
.session-list-scroll::-webkit-scrollbar {
    width: 4px;
}

.session-list-scroll::-webkit-scrollbar-track {
    background: transparent;
}

.session-list-scroll::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.08);
    border-radius: 4px;
}

.session-list-scroll::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.15);
}

.glass-input {
    @apply bg-surface-50 border border-surface-200 transition-colors duration-150 rounded-xl px-4 py-2.5 text-sm;
}

.glass-input:focus {
    @apply bg-white border-brand-400 ring-2 ring-brand-500/20 outline-none;
}

/* ─── Custom Select / Dropdown ───────────────────────────────────── */
.custom-select {
    @apply bg-white border border-surface-200 rounded-xl px-4 py-2.5 pr-10 text-sm font-medium text-surface-800 cursor-pointer;
    @apply transition-all duration-150;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%2364748b'%3E%3Cpath fill-rule='evenodd' d='M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.625rem center;
    background-size: 1.25rem 1.25rem;
}

.custom-select:hover {
    @apply border-brand-300 bg-brand-50/30;
}

.custom-select:focus {
    @apply outline-none border-brand-400 ring-2 ring-brand-500/20 bg-white;
}

.custom-select option {
    @apply font-medium text-surface-800 bg-white py-2;
}

/* ─── Gradient Utilities ────────────────────────────────────────── */
.gradient-brand {
    background: var(--gradient-brand);
}

.gradient-accent {
    background: var(--gradient-accent);
}

.gradient-hero {
    background: var(--gradient-hero);
}

.gradient-text {
    @apply bg-clip-text text-transparent;
    background-image: linear-gradient(135deg, #1c8090 0%, #3abac6 50%, #1f9eab 100%);
}

/* ─── Status Indicators ──────────────────────────────────────────── */
.status-dot {
    @apply w-2 h-2 rounded-full inline-block;
}

.status-dot-online {
    @apply bg-accent-400;
}

.status-dot-offline {
    @apply bg-red-400;
}

.status-dot-connecting {
    @apply bg-amber-400;
}

/* ─── Scrollbar ──────────────────────────────────────────────────── */
::-webkit-scrollbar {
    width: 5px;
    height: 5px;
}

::-webkit-scrollbar-track {
    @apply bg-transparent;
}

::-webkit-scrollbar-thumb {
    @apply bg-surface-300/60 rounded-full;
    transition: background 0.2s;
}

::-webkit-scrollbar-thumb:hover {
    @apply bg-brand-400/60;
}

/* ─── Markdown in Chat ───────────────────────────────────────────── */
.chat-markdown {
    overflow-wrap: anywhere;
    word-break: break-word;
    line-height: 1.7;
}

/* ── Headings ── */
.chat-markdown h1,
.chat-markdown h2,
.chat-markdown h3 {
    @apply font-semibold mt-4 mb-2 text-surface-900;
}

.chat-markdown h1 {
    @apply text-lg pb-1;
    border-bottom: 2px solid theme('colors.brand.200');
}

.chat-markdown h2 {
    @apply text-base border-l-[3px] border-brand-500 pl-3;
}

.chat-markdown h3 {
    @apply text-[15px] text-brand-700;
}

/* ── Paragraphs ── */
.chat-markdown p {
    @apply mb-2.5 leading-relaxed;
}

/* ── Inline code ── */
.chat-markdown code {
    @apply bg-brand-50 text-brand-700 px-1.5 py-0.5 rounded text-[13px] font-mono border border-brand-100;
}

/* ── Code blocks ── */
.chat-markdown pre {
    @apply bg-[#1e1e2e] text-green-400 p-4 rounded-xl my-3 overflow-x-auto text-sm;
    border: 1px solid #2a2a3e;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.chat-markdown pre code {
    @apply bg-transparent text-green-400 p-0 border-0;
}

/* ── Lists ── */
.chat-markdown ul,
.chat-markdown ol {
    @apply ml-1 mb-2 pl-0;
}

.chat-markdown ul {
    list-style: none;
}

.chat-markdown ul>li {
    @apply mb-1.5 pl-5 relative;
}

.chat-markdown ul>li::before {
    content: '';
    @apply absolute left-0 top-[0.55em] w-2 h-2 rounded-full;
    background: var(--gradient-brand);
    opacity: 0.7;
}

.chat-markdown ol {
    list-style: none;
    counter-reset: ol-counter;
}

.chat-markdown ol>li {
    @apply mb-1.5 pl-7 relative;
    counter-increment: ol-counter;
}

.chat-markdown ol>li::before {
    content: counter(ol-counter);
    @apply absolute left-0 top-[0.15em] w-5 h-5 rounded-full text-[11px] font-bold flex items-center justify-center text-white;
    background: var(--gradient-brand);
}

.chat-markdown li {
    @apply leading-relaxed;
}

/* Nested lists */
.chat-markdown li ul,
.chat-markdown li ol {
    @apply mt-1;
}

.chat-markdown li ul>li::before {
    @apply w-1.5 h-1.5;
    opacity: 0.5;
}

/* ── Tables ── */
.chat-markdown table {
    @apply w-full border-collapse my-3 text-sm overflow-hidden;
    border: 1px solid theme('colors.surface.200');
    border-radius: 0.75rem;
}

.chat-markdown thead {
    background: var(--gradient-brand);
}

.chat-markdown th {
    @apply px-3 py-2.5 text-left font-semibold text-white text-xs uppercase tracking-wider;
    border: none;
}

.chat-markdown th:not(:last-child) {
    border-right: 1px solid rgba(255, 255, 255, 0.15);
}

.chat-markdown td {
    @apply border border-surface-200 px-3 py-2 text-surface-700;
}

.chat-markdown tbody tr:nth-child(even) {
    @apply bg-surface-50/50;
}

.chat-markdown tbody tr:hover {
    @apply bg-brand-50/30;
    transition: background 0.15s;
}

/* ── Links ── */
.chat-markdown a {
    @apply text-brand-600 underline decoration-brand-300 underline-offset-2 cursor-pointer;
    transition: color 0.15s, text-decoration-color 0.15s;
}

.chat-markdown a:hover {
    @apply text-brand-700 decoration-brand-500;
}

.chat-markdown a:visited {
    @apply text-brand-700;
}

/* ── Blockquotes ── */
.chat-markdown blockquote {
    @apply border-l-4 border-brand-400 pl-4 my-3 text-surface-600 py-2 rounded-r-lg;
    background: linear-gradient(135deg, rgba(28, 128, 144, 0.04) 0%, rgba(58, 186, 198, 0.06) 100%);
}

.chat-markdown blockquote p {
    @apply mb-1;
}

/* ── Horizontal rules ── */
.chat-markdown hr {
    @apply my-4 border-0 h-[2px];
    background: linear-gradient(to right, transparent, theme('colors.brand.200'), transparent);
}

/* ── Collapsible sections (<details>) ───────────────────────────── */
.chat-markdown details {
    @apply my-3 border border-surface-200 rounded-xl overflow-hidden;
}

.chat-markdown details summary {
    @apply px-4 py-2.5 bg-surface-50 cursor-pointer font-medium text-sm text-surface-700 hover:bg-brand-50/50 transition-colors select-none list-none;
}

.chat-markdown details summary::-webkit-details-marker {
    display: none;
}

.chat-markdown details summary::before {
    content: '▸ ';
    @apply text-brand-500 mr-1;
}

.chat-markdown details[open] summary::before {
    content: '▾ ';
}

.chat-markdown details[open] summary {
    @apply border-b border-surface-200;
}

.chat-markdown details> :not(summary) {
    @apply px-4 py-2;
}

/* ── Source citation badges ─────────────────────────────────────── */
.chat-markdown blockquote a {
    @apply no-underline bg-brand-50 text-brand-700 px-2 py-0.5 rounded-md text-xs font-medium border border-brand-200 hover:bg-brand-100 transition-colors;
}

/* ── Strong / Bold ── */
.chat-markdown strong {
    @apply font-semibold text-surface-900;
}

/* ─── Mermaid Diagram Containers ─────────────────────────────────── */
.mermaid-container {
    @apply my-4 rounded-xl border overflow-hidden;
}

.mermaid-container.mermaid-rendered {
    @apply border-brand-200/60 bg-white;
    border-top: 3px solid theme('colors.brand.500');
    padding: 16px 20px;
    box-shadow: 0 1px 4px rgba(28, 128, 144, 0.06), 0 4px 12px rgba(0, 0, 0, 0.03);
}

.mermaid-container.mermaid-loading {
    @apply border-surface-200 bg-surface-50/50;
    padding: 16px;
}

.mermaid-container.mermaid-fallback {
    @apply border-amber-200 bg-amber-50/30;
    padding: 16px;
}

.mermaid-svg-wrapper {
    @apply flex justify-center overflow-x-auto cursor-pointer;
    position: relative;
}

.mermaid-svg-wrapper:hover::after {
    content: 'Click to expand';
    @apply absolute top-2 right-2 text-[10px] font-medium text-white px-2 py-1 rounded-md;
    background: rgba(28, 128, 144, 0.75);
    backdrop-filter: blur(4px);
    pointer-events: none;
    opacity: 0;
    animation: fadeInHint 0.2s ease forwards;
}

@keyframes fadeInHint {
    to {
        opacity: 1;
    }
}

.mermaid-svg-wrapper svg {
    height: auto;
    min-width: min-content;
}

/* ─── Mermaid Fullscreen Modal ───────────────────────────────────── */
.mermaid-modal-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(15, 23, 42, 0.85);
    backdrop-filter: blur(8px);
    display: flex;
    flex-direction: column;
}

.mermaid-modal-toolbar {
    @apply flex items-center justify-between px-5 py-3 border-b;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    border-color: theme('colors.surface.200');
    flex-shrink: 0;
}

.mermaid-modal-btn {
    @apply w-8 h-8 flex items-center justify-center rounded-lg text-surface-500 transition-all;
}

.mermaid-modal-btn:hover {
    @apply bg-brand-50 text-brand-600;
}

.mermaid-modal-btn-close:hover {
    @apply bg-red-50 text-red-500;
}

.mermaid-modal-canvas {
    flex: 1;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: none;
    user-select: none;
}

.mermaid-modal-diagram {
    transform-origin: center center;
    transition: none;
    will-change: transform;
}

.mermaid-modal-diagram svg {
    max-width: none !important;
    height: auto;
    filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.12));
}

.mermaid-modal-hint {
    @apply text-[11px] text-surface-400 text-center py-2;
    background: rgba(255, 255, 255, 0.9);
    border-top: 1px solid theme('colors.surface.200');
    flex-shrink: 0;
}

/* ─── Stage Pipeline Line ────────────────────────────────────────── */
.stage-connector {
    position: relative;
}

.stage-connector::after {
    content: '';
    position: absolute;
    top: 50%;
    right: -12px;
    width: 24px;
    height: 2px;
    background: linear-gradient(90deg, #e2e8f0, #cbd5e1);
    transform: translateY(-50%);
}

.stage-connector:last-child::after {
    display: none;
}

.stage-connector.stage-active::after {
    background: linear-gradient(90deg, #1c8090, #3abac6);
}

.stage-connector.stage-passed::after {
    background: linear-gradient(90deg, #10b981, #34d399);
}

/* ─── Focus styles ───────────────────────────────────────────────── */
*:focus-visible {
    @apply outline-none ring-2 ring-brand-500/40 ring-offset-2 ring-offset-white;
}

/* ─── Transition helpers ─────────────────────────────────────────── */
.transition-default {
    @apply transition-all duration-200 ease-out;
}

.hover-lift {
    @apply transition-colors duration-150;
}

.hover-lift:hover {
    @apply shadow-card-hover;
}

/* ─── Chat Animations ────────────────────────────────────────────── */
.typing-dot {
    @apply w-1 h-1 rounded-full bg-brand-400 inline-block;
    animation: typingBounce 1.2s ease-in-out infinite;
}

@keyframes typingBounce {

    0%,
    60%,
    100% {
        opacity: 0.3;
        transform: translateY(0);
    }

    30% {
        opacity: 1;
        transform: translateY(-3px);
    }
}

.animate-spin-slow {
    animation: spin 2.5s linear infinite;
}

/* ─── Chat Sidebar Scrollbar ─────────────────────────────────────── */
.chat-sidebar-scroll::-webkit-scrollbar {
    width: 4px;
}

.chat-sidebar-scroll::-webkit-scrollbar-track {
    background: transparent;
}

.chat-sidebar-scroll::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.08);
    border-radius: 4px;
}

.chat-sidebar-scroll::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.15);
}

/* ═════════════════════════════════════════════════════════════════════
   Report Theme System (rpt-* classes) — Scoped via #report-container
   Light mode (default) + Dark mode ([data-theme="dark"])
   ═════════════════════════════════════════════════════════════════════ */

/* ─── Page background ─── */
.rpt-page-bg {
    background: #f8fafc;
    transition: background 0.3s ease;
}

/* ─── Text ─── */
.rpt-text-primary {
    @apply text-surface-800;
}

.rpt-text-secondary {
    @apply text-surface-600;
}

.rpt-text-muted {
    @apply text-surface-400;
}

/* ─── Divider ─── */
.rpt-divider {
    @apply bg-surface-200;
}

.rpt-border {
    @apply border-surface-200;
}

/* ─── Report header card ─── */
.rpt-report-header {
    @apply bg-white border border-surface-200 shadow-card;
}

.rpt-header-icon {
    @apply bg-brand-100 text-brand-600;
}

/* ─── Tab bar (underline style) ─── */
.rpt-tab-underline-active {
    @apply border-brand-500 text-brand-700;
}

/* ─── Stats strip ─── */
.rpt-stats-strip {
    @apply bg-white border border-surface-200;
}

/* ─── Search box (standalone) ─── */
.rpt-search-box {
    @apply bg-white border border-surface-200;
}

/* ─── Toggle buttons (Retry/Flaky inactive) ─── */
.rpt-toggle-inactive {
    @apply border-surface-300 text-surface-500 bg-transparent;
}

.rpt-toggle-inactive:hover {
    @apply bg-surface-50 text-surface-700;
}

/* ─── Sort select ─── */
.rpt-sort-select {
    @apply bg-transparent border border-surface-200 text-surface-700;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%2364748b'%3E%3Cpath fill-rule='evenodd' d='M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.4rem center;
    background-size: 1rem 1rem;
}

/* ─── Suite list container ─── */
.rpt-suite-list {
    @apply bg-white border border-surface-200;
}

/* ─── Suite row separator ─── */
.rpt-suite-row {
    @apply border-b border-surface-100;
}

.rpt-suite-row:last-child {
    @apply border-b-0;
}

/* ─── Suite button ─── */
.rpt-suite-btn {
    @apply bg-transparent;
}

.rpt-suite-btn:hover {
    @apply bg-surface-50;
}

/* ─── Count badge (Allure green) ─── */
.rpt-count-badge {
    @apply px-2.5 py-1 text-[11px] font-bold rounded-md bg-accent-500 text-white;
    min-width: 28px;
    text-align: center;
}

/* ─── Spec item ─── */
.rpt-spec-item {
    @apply transition-colors;
}

.rpt-spec-item:hover {
    @apply bg-surface-50;
}

/* ─── Error panels ─── */
.rpt-error-panel {
    @apply text-red-700 bg-red-50/80 border border-red-200;
}

.rpt-error-broken {
    @apply text-orange-700 bg-orange-50/80 border border-orange-200;
}

/* ─── Donut chart ─── */
.rpt-donut-track {
    stroke: #e2e8f0;
}

/* ═════════════════════════════════════════════════════════════════════
   DARK THEME — Scoped to [data-theme="dark"]
   ═════════════════════════════════════════════════════════════════════ */

[data-theme="dark"] .rpt-page-bg {
    background: #1a1b26;
}

[data-theme="dark"] {
    --gradient-hero: linear-gradient(135deg, #0d2e37 0%, #1a4550 30%, #1d6876 60%, #1c8090 100%);
}

[data-theme="dark"] .rpt-text-primary {
    color: #e2e8f0;
}

[data-theme="dark"] .rpt-text-secondary {
    color: #94a3b8;
}

[data-theme="dark"] .rpt-text-muted {
    color: #64748b;
}

[data-theme="dark"] .rpt-divider {
    background: #334155;
}

[data-theme="dark"] .rpt-border {
    border-color: #334155;
}

[data-theme="dark"] .rpt-report-header {
    background: #24253a;
    border-color: #2e2f45;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .rpt-header-icon {
    background: rgba(28, 128, 144, 0.2);
    color: #3abac6;
}

[data-theme="dark"] .rpt-tab-underline-active {
    border-color: #3abac6;
    color: #e2e8f0;
}

[data-theme="dark"] .rpt-stats-strip {
    background: transparent;
    border-color: transparent;
}

[data-theme="dark"] .rpt-search-box {
    background: #24253a;
    border-color: #2e2f45;
}

[data-theme="dark"] .rpt-search-box input {
    color: #e2e8f0;
}

[data-theme="dark"] .rpt-search-box input::placeholder {
    color: #64748b;
}

[data-theme="dark"] .rpt-toggle-inactive {
    border-color: #475569;
    color: #94a3b8;
    background: transparent;
}

[data-theme="dark"] .rpt-toggle-inactive:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #e2e8f0;
}

[data-theme="dark"] .rpt-pill {
    border-color: #475569 !important;
}

[data-theme="dark"] .rpt-pill:hover {
    background: rgba(255, 255, 255, 0.05) !important;
}

[data-theme="dark"] .rpt-sort-select {
    background-color: transparent;
    border-color: #475569;
    color: #94a3b8;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%2394a3b8'%3E%3Cpath fill-rule='evenodd' d='M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd'/%3E%3C/svg%3E");
}

[data-theme="dark"] .rpt-suite-list {
    background: #24253a;
    border-color: #2e2f45;
}

[data-theme="dark"] .rpt-suite-row {
    border-bottom-color: #2e2f45;
}

[data-theme="dark"] .rpt-suite-btn:hover {
    background: rgba(255, 255, 255, 0.04);
}

[data-theme="dark"] .rpt-count-badge {
    background: #10b981;
    color: #fff;
}

[data-theme="dark"] .rpt-spec-item:hover {
    background: rgba(255, 255, 255, 0.03);
}

[data-theme="dark"] .rpt-error-panel {
    background: rgba(239, 68, 68, 0.08);
    border-color: rgba(239, 68, 68, 0.2);
    color: #fca5a5;
}

[data-theme="dark"] .rpt-error-broken {
    background: rgba(249, 115, 22, 0.08);
    border-color: rgba(249, 115, 22, 0.2);
    color: #fdba74;
}

[data-theme="dark"] .rpt-donut-track {
    stroke: #334155;
}