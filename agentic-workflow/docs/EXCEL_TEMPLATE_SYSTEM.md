# ğŸ“‹ Test Case Excel Template System

## Overview

This system ensures **100% consistent formatting** for all manual test case Excel files generated by the TestGenie agent. It enforces the Doremon Team branding and standardized structure.

## ğŸ¯ Purpose

**Problem:** TestGenie was generating Excel files with inconsistent formatting - different colors, column widths, fonts, and cell styles.

**Solution:** A single, strictly enforced template generator that ALL test case Excel files must use.

---

## ğŸ—ï¸ Architecture

### 1. Template Generator (`excel-template-generator.js`)
The **single source of truth** for Excel formatting.

**Usage:**
```javascript
const { generateTestCaseExcel, validateTestCases } = require('./scripts/excel-template-generator.js');

// âš ï¸ IMPORTANT: Data should be dynamically fetched from Jira
// This example shows the required data structure after fetching from Jira

// Fetch ticket data from Jira API (using Atlassian MCP)
const ticketData = await fetchJiraTicket('AOTF-16461');

// Prepare data from Jira response (DYNAMIC)
const jiraInfo = {
  number: ticketData.key,              // From Jira: 'AOTF-16461'
  title: ticketData.fields.summary,    // From Jira: 'Add Roomvo clause verification'
  url: ticketData.self                 // From Jira: full URL
};

// Generate from ticket context (DYNAMIC)
const preConditions = generatePreConditions(ticketData);
// Result: 'User is on property details page with Roomvo available'

// Generate from acceptance criteria (DYNAMIC)
const testCases = await generateTestCases(ticketData);
// Result: [
  {
    id: 'TC-1',
    title: 'Verify Roomvo clause display',
    steps: [
      {
        id: '1.1',
        action: 'Navigate to property details page',
        expected: 'Page loads with property information',
        actual: 'Page loads with property information'
      },
      {
        id: '1.2',
        action: 'Locate Roomvo clause section',
        expected: 'Roomvo clause is visible below images',
        actual: 'Roomvo clause is visible'
      }
    ]
  }
];

// Validate before generating
const validation = validateTestCases(testCases);
if (!validation.valid) {
  console.error('Validation failed:', validation.errors);
  process.exit(1);
}

// Generate Excel
const outputPath = './test-cases/AOTF-16461.xlsx';
await generateTestCaseExcel(jiraInfo, preConditions, testCases, outputPath);
```

### 2. Template Validator (`validate-test-case-excel.js`)
Checks that generated Excel files follow the template exactly.

**Usage:**
```bash
node scripts/validate-test-case-excel.js test-cases/AOTF-16461.xlsx
```

**Or use NPM script:**
```bash
npm run validate-excel test-cases/AOTF-16461.xlsx
```

---

## ğŸ“ Template Specifications

### Section 1: Doremon Team Header
- **Row 1:** "ğŸš€ğŸ’™ Powered by Doremon Team ğŸ’™ğŸš€"
  - Font: Bold, Size 14, Color #0066CC (Doremon Blue)
  - Alignment: Center
  - Merged across columns A-D

### Section 2: Jira Information (Rows 3-5)
- **Row 3:** `Jira Ticket Number: | AOTF-16461`
- **Row 4:** `Jira Ticket Title: | [Title]`
- **Row 5:** `Jira Ticket URL: | [URL with hyperlink]`
  - Labels (Column A): Bold
  - Values (Columns B-D): Merged cells
  - URL: Blue color, underlined

### Section 3: Pre-Conditions (Row 7)
- **Row 7:** `Pre-Conditions (If any): | [Conditions]`
  - Label: Bold
  - Value: Merged across columns B-D

### Section 4: Separator Bar (Row 8)
- Gray background (#E7E6E6) across all columns

### Section 5: Test Cases (Row 10+)
Each test case follows this structure:

**Title Row:**
- Format: `TC-1: Verify feature functionality`
- Font: Bold, Size 12
- Background: Light Blue (#D9E2F3)
- Merged across columns A-D

**Header Row:**
| Test Step ID | Specific Activity or Action | Expected Results | Actual Results |
|--------------|----------------------------|------------------|----------------|
- Font: Bold, White (#FFFFFF)
- Background: Blue (#4472C4)
- Alignment: Center

**Data Rows:**
- All cells: Borders (thin, black), Top-aligned, Text wrapping enabled
- Column widths:
  - A (Test Step ID): 15
  - B (Activity/Action): 55
  - C (Expected Results): 45
  - D (Actual Results): 45

---

## ğŸ”’ Enforcement Rules

### âœ… TestGenie Agent MUST:
1. Import and use `excel-template-generator.js`
2. Validate test cases with `validateTestCases()` before generation
3. Pass exact data structure (jiraInfo, preConditions, testCases)
4. Save files to `test-cases/` directory with format `AOTF-{number}.xlsx`

### âŒ TestGenie Agent MUST NOT:
1. Create Excel files using ExcelJS directly
2. Modify any colors, fonts, or column widths
3. Change section order or structure
4. Skip validation step
5. Use different field names or headers

---

## ğŸ§ª Testing the Template

### Generate Sample Test Case
```bash
node scripts/excel-template-generator.js
```

### Validate Generated File
```bash
npm run validate-excel test-cases/AOTF-16461.xlsx
```

### Expected Output (Valid):
```
ğŸ” Validating: test-cases/AOTF-16461.xlsx

âœ… VALIDATION PASSED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Summary: 0 errors, 0 warnings
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Expected Output (Invalid):
```
ğŸ” Validating: test-cases/AOTF-16461.xlsx

âŒ VALIDATION FAILED

Errors:
  1. Row 1: Missing "Powered by Doremon Team" header
  2. Missing Jira information: Found 2/3 required labels

âš ï¸  Warnings:
  1. Column 2 (Specific Activity or Action): Width is 40.0, expected 54-56
  2. Header cell background: Got FF123456, expected FF4472C4

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Summary: 2 errors, 2 warnings
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ”„ Integration with TestGenie

The TestGenie agent now includes mandatory template usage in its instructions:

1. **Before Excel Generation:**
   ```javascript
   const validation = validateTestCases(testCases);
   if (!validation.valid) {
     throw new Error(`Validation failed: ${validation.errors.join(', ')}`);
   }
   ```

2. **Generate Excel:**
   ```javascript
   const outputPath = path.resolve('test-cases', `${ticketNumber}.xlsx`);
   await generateTestCaseExcel(jiraInfo, preConditions, testCases, outputPath);
   ```

3. **Verify Creation:**
   ```javascript
   const stats = fs.statSync(outputPath);
   console.log(`âœ… Excel file created: ${outputPath} (${stats.size} bytes)`);
   ```

---

## ğŸ“¦ NPM Scripts

Add to `package.json`:

```json
{
  "scripts": {
    "validate-excel": "node scripts/validate-test-case-excel.js",
    "generate-sample": "node scripts/excel-template-generator.js"
  }
}
```

---

## ğŸ¨ Color Reference

| Element | Color Code | Usage |
|---------|-----------|--------|
| Doremon Blue | #0066CC | Header text, URLs |
| Header Background | #4472C4 | Table headers |
| Header Text | #FFFFFF | Text on headers |
| Test Case Title | #D9E2F3 | Test case title background |
| Separator | #E7E6E6 | Section divider |
| Black Text | #000000 | Standard text, borders |

---

## ğŸš¨ Troubleshooting

### Issue: Excel file doesn't match template
**Solution:** Use the validator to identify specific issues:
```bash
npm run validate-excel test-cases/AOTF-16461.xlsx
```

### Issue: TestGenie generates inconsistent formatting
**Solution:** Ensure TestGenie is using the template generator:
- Check that `require('./scripts/excel-template-generator.js')` is present
- Verify data structure matches expected format
- Confirm validation step is not skipped

### Issue: Colors look different in Excel
**Solution:** Ensure ARGB color codes are used correctly:
- Use format: `FF0066CC` (not `#0066CC`)
- Always include alpha channel (FF prefix)

---

## ğŸ“ Maintenance

### To Update Template:
1. Modify ONLY `scripts/excel-template-generator.js`
2. Update `COLORS` and `COLUMN_WIDTHS` constants if needed
3. Update validator (`validate-test-case-excel.js`) to match
4. Regenerate all test cases to apply new template
5. Update this README with any changes

### Version History:
- **v1.0** (2026-01-19): Initial template system with strict enforcement

---

## âœ… Checklist for TestGenie Developers

Before releasing any TestGenie updates:

- [ ] Excel generation uses `excel-template-generator.js`
- [ ] Test case validation is performed before generation
- [ ] No direct ExcelJS usage in TestGenie code
- [ ] Sample test case passes validation
- [ ] Colors, fonts, and widths match template exactly
- [ ] All four sections (Header, Jira, Pre-conditions, Test Cases) present
- [ ] File saved to `test-cases/` directory

---

## ğŸ“ Support

If you encounter issues with the template system:
1. Run the validator to diagnose the problem
2. Check this README for troubleshooting steps
3. Review `excel-template-generator.js` for proper usage
4. Contact Doremon Team for assistance

---

ğŸš€ğŸ’™ **Powered by Doremon Team** ğŸ’™ğŸš€
